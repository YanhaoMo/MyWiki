# TCP 协议

# 建立连接

为了保证可靠连接，tcp建立连接需要“三次握手”，这三次握手对tcp的性能有至关重要的影响。
如何缩小这三次握手给性能带来的影响是网络性能调优的一个重要关注点。

### 三次握手

* 客户端发送`SYN(SEQ=x)`报文给服务器端，进入`SYN_SEND`状态。

首先，客户端需要向服务器端发一个 SYN 报文，用一个随机的序号。

然后，服务器端回复一个 SYN+ACK 包，用一个随机的序号

然后，客户端向服务器回复一个 SYN+ACK 报文

至此，整个连接建立完成。

# 拥塞控制

拥塞控制机制是传输层为了保证网络质量而施加的保护措施，但是这样一来，
整个拥塞控制机制会使得tcp连接在很多时候难以发挥出最好的性能，
如何减小tcp拥塞控制带来的性能损失，也是tcp性能调优的一个关键点。

拥塞控制的几个关键词

慢开始，拥塞避免，快恢复，快重传

拥塞控制的几个关键参数：

下面的几个变量是用来配置拥塞控制的。

* snd_cwnd          设置拥塞窗口大小
* snd_ssthresh      慢开始门限
* snd\_cwnd_cnt
* snd\_cwnd_clamp
* snd\_cwnd_stamp
* snd\_cwnd_used

# 释放连接
TCP连接的释放也是一个复杂的过程，在这个地方，提升网络性能的关键是如何快速释放一个不在使用的连接，
或者如何重用一个连接。

# 特殊机制
tcp中还存一些特殊机制来应对各种不同的情况，这些地方的性能问题也是值得考察的。